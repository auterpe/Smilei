<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Parallelization &mdash; Smilei v2.2-58-g46430ba
 documentation</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/smileitheme.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     'v2.2-58-g46430ba
',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="_static/smileiIcon.ico"/>
    <link rel="top" title="Smilei v2.2-58-g46430ba
 documentation" href="index.html" />
    <link rel="next" title="Binary collisions" href="collisions.html" />
    <link rel="prev" title="PIC algorithms" href="algorithms.html" />
  <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    "HTML-CSS": {
      availableFonts: ["TeX"]
    }
  });
  </script>
  
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />


  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="collisions.html" title="Binary collisions"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="algorithms.html" title="PIC algorithms"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Smilei</a> &raquo;</li>
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="parallelization">
<h1>Parallelization<a class="headerlink" href="#parallelization" title="Permalink to this headline">Â¶</a></h1>
<p>Supercomputers now have complex architectures, mainly due to the computing units
(CU) able to work together on the same memory space. More precisely, CUs
are grouped in <em>nodes</em>. All the CUs in one node share the same memory space, and two
CUs located on two distinct nodes do not have access to the same memory space.
This differs from older supercomputers, where two distinct CUs never shared their memory.</p>
<p>To take advantage of this new technology, <strong class="program">Smilei</strong> proposes a new approach
to decompose the simulation between all the CUs. Traditionally, PIC codes would
split the spatial grid into <span class="math">\(N_{CU}\)</span> domains, where <span class="math">\(N_{CU}\)</span> is the number
of CUs. Each CU would handle its own domain, and information was communicated between domains
using the MPI protocol. <strong class="program">Smilei</strong> also decomposes the spatial grid in several
domains, but one CU is not directly associated to one domain.</p>
<p>Let us explain this difference in details.
<a class="reference internal" href="#patchdecomposition"><span class="std std-numref">Fig. 1</span></a> gives an example of a grid containing 960 cells.
It is decomposed in <span class="math">\(4\times8 = 32\)</span> sub-domains, called <strong>patches</strong>.
These patches can be very small: down to <span class="math">\(5\times5\)</span> cells.</p>
<p>The issue is now to decide where these patches will be stored in the memory.
Recall that all the CUs in one <em>node</em> share the same memory: we will refer to this
memory as an <em>MPI region</em>. A clever algorithm assigns several patches to each MPI
region. <a class="reference internal" href="#patchdecomposition"><span class="std std-numref">Fig. 1</span></a> shows an example with the 32 patches split
in 5 regions recognized by their different colors.
Note that these regions are not necessarily rectangular.</p>
<div class="figure" id="id1">
<span id="patchdecomposition"></span><a class="reference internal image-reference" href="_images/PatchDecomposition.png"><img alt="_images/PatchDecomposition.png" src="_images/PatchDecomposition.png" style="width: 10cm;" /></a>
<p class="caption"><span class="caption-number">Fig. 1 </span><span class="caption-text">Decomposition of a grid in <em>patches</em> and <em>MPI regions</em>.</span></p>
</div>
<p>Each MPI region is handled by all the CUs of the node. For example, if there are
4 CUs in the node that handles the region colored in green, this means the 4 CUs will
handle 10 patches. The 4 CUs will successively work on the next available patch until
all patches are done.</p>
<p>To handle patches simultaneously in a given node, <strong class="program">Smilei</strong> uses the
<em>OpenMP</em> protocol. This ensure that all the CUs in one node can run together on the
same memory.</p>
<p class="rubric">Advantages</p>
<ul class="simple">
<li>Inside one MPI region, the CUs do not need to wait for their friends to go to the
next patch; they can continue working on the next patch, thus avoiding long waiting
times. This is a form of <strong>local load balancing</strong>.</li>
<li>The patches are regularly
exchanged between MPI regions in order to uniformize the load carried by each.
This is a form of <strong>global load balancing</strong>.</li>
<li>As the patches can be small, moving a patch from one MPI region to another is
fast: it can fit more easily in the cache, and does not require heavy memory
access.</li>
</ul>
<p class="rubric">Rules</p>
<ul class="simple">
<li>In each direction <span class="math">\(x\)</span>, <span class="math">\(y\)</span>, <span class="math">\(z\)</span>, the number of patches must be
a power of 2.</li>
<li>There must be more patches than CUs.</li>
</ul>
<p class="rubric">Recommendations</p>
<ul class="simple">
<li><strong>Have as many MPI processes as nodes</strong> in order to optimize the memory sharing.</li>
<li>In each node, <strong>have as many OpenMP threads as CUs</strong>. If you have less threads than CUs,
you will not be using all your CUs. If you have more threads than CUs (overthreading),
some threads will be treated sequentially.</li>
<li><strong>Have small patches</strong>. They can efficiently be as small as 5 cells in each direction.
This allows good cache use, but also ensures that you have at least as many threads
as patches, so that they can be treated in parallel.</li>
</ul>
<p class="inprogress">In progress ...</p>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/smileiLogo.svg" alt="Logo"/>
            </a></p>







<div class="toctree-smilei">

    
    
    
    
    
      <ul>
      <li>
        <a href="licence.html">Licence</a>
      </li>
      </ul>
    

    
    
    
    
    
      <ul>
      <li>
        <a href="synopsis.html">Synopsis</a>
      </li>
      </ul>
    

    
    
    
    
    
      <ul>
      <li>
        <a href="highlights.html">Highlights</a>
      </li>
      </ul>
    

    
    
    
    
    
      <ul>
      <li>
        <a href="releases.html">Releases</a>
      </li>
      </ul>
    

    
    
    
    
    <hr />
    
    
      <ul>
      <li>
        <a href="units.html">Units</a>
      </li>
      </ul>
    

    
    
    
    
    
      <ul>
      <li>
        <a href="algorithms.html">PIC algorithms</a>
      </li>
      </ul>
    

    
    
    
    
    
        <ul>
<li><a class="reference internal" href="#">Parallelization</a></li>
</ul>

    

    
    
    
    
    
      <ul>
      <li>
        <a href="collisions.html">Binary collisions</a>
      </li>
      </ul>
    

    
    
    
    
    <hr />
    
    
      <ul>
      <li>
        <a href="installation.html">Install</a>
      </li>
      </ul>
    

    
    
    
    
    
      <ul>
      <li>
        <a href="namelist.html">Write a namelist</a>
      </li>
      </ul>
    

    
    
    
    
    
      <ul>
      <li>
        <a href="post-processing.html">Post-process</a>
      </li>
      </ul>
    

    
    
    
    
    <hr />
    
    
      <ul>
      <li>
        <a href="material.html">Material</a>
      </li>
      </ul>
    

    
    
    
    
    
      <ul>
      <li>
        <a href="partners.html">Partners</a>
      </li>
      </ul>
    

    
    
    
    
    
      <ul>
      <li>
        <a href=""></a>
      </li>
      </ul>
    

</div>


<br />
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
<h3>Partners</h3>


<div class="lablogos">
  <div>
  <a href="http://www.maisondelasimulation.fr"><img src="_static/labs/mdls.png" border="0" width=100px/> </a>
  </div>
  <div>
  <a href="http://www.luli.polytechnique.fr"><img src="_static/labs/luli.png" border="0" width=100px/> </a>
  </div>
  <div>
  <a href="http://www.lpp.fr"><img src="_static/labs/lpp.png" border="0" width=100px/> </a>
  </div>
  <div>
  <a href="http://polywww.in2p3.fr"><img src="_static/labs/llr.png" border="0" width=100px/> </a>
  </div>
  <div>
  <a href="http://www.idris.fr"><img src="_static/labs/idris.png" border="0" width=100px/> </a>
  </div>
  <br class="clear" />
</div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
        Last updated on Jun 29, 2016
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.4.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.8</a>
      
      |
      <a href="_sources/parallelization.txt"
          rel="nofollow">Page source</a></li>
    </div>
  </body>
</html>